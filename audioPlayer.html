<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Player</title>
    <style>
        * {
            margin: 0.5rem;
        }

        body {
            display: flex;
            min-height: 95vh;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .buttonsAudioControl {
            display: flex;
            flex-direction: row;
        }
    </style>
</head>

<body>
    <input class="audioInput" type="file" multiple />
    <input type="submit" onclick="loadFiles('.audioInput', 0)" />
    <div class="buttonsAudioControl">
        <button class="audioBack" onclick="buttonBackAction()">‚èÆ</button>
        <button class="audioPlay" onclick="buttonPlayAction()">‚ñ∂</button>
        <button class="audioNext" onclick="buttonNextAction()">‚è≠</button>
        <button class="audioLoop" onclick="buttonLoopAction()">‚Ü™</button>
        <button class="audioAutoPlay" onclick="buttonAutoPlayAction()">‚§µ</button>
        <button class="audioShuffle" onclick="buttonShuffleAction()">‚û°</button>
    </div>
    <audio controls class="audioToPlay">
        <source />
    </audio>

    <div class="Playlist">
        <span class="playlistAudio">1</span>
    </div>

    <script>
        let audioFiles;
        let playing = false;
        let buttonPlay = document.querySelector(".audioPlay") //declared on global scope
        //buttonPlay also used in buttonBackAction() and buttonNextAction()
        let buttonPlayState = "play";
        let buttonLoopState = 0;
        let buttonAutoPlayState = 0;
        let buttonShuffleState = 0;
        let audioPlayer = document.querySelector(".audioToPlay")
        let currentAudio
        let ascendingNumbers = []
        let shuffledNumbers = []
        let originalAudioFiles

        audioPlayer.addEventListener('ended', function () {
            if (buttonAutoPlayState === 1) {
                if (buttonLoopState === 1) {
                    selectAudio(audioFiles, findFileIndex(audioFiles, currentAudio))
                    audioPlayer.play()
                } else {
                    let nextFile = findFileIndex(audioFiles, currentAudio) + 1
                    if (nextFile > audioFiles.length - 1) {
                        if (buttonLoopState === 2) {
                            selectAudio(audioFiles, nextFile - audioFiles.length);
                            audioPlayer.play();
                        }
                    } else {
                        selectAudio(audioFiles, nextFile);
                        audioPlayer.play();
                    }
                }
            } else { buttonPlayAction() };
        });

        function loadFiles(input, pos) {
            audioFiles = document.querySelectorAll(input)[pos].files
            selectAudio(audioFiles, 0);
            for (i = 0; i < audioFiles.length; i++) {
                ascendingNumbers.push(i);
            }
        }

        function selectAudio(fileList, pos) {
            currentAudio = fileList[pos];
            let sourceAudio = audioPlayer.querySelector("source")
            if (pos < 0) {
                pos = fileList.length + pos;
            }
            audioPlayer.src = URL.createObjectURL(fileList[pos]);
        }

        function findFileIndex(fileList, file) {
            for (let i = 0; i < fileList.length; i++) {
                if (fileList[i].name === file.name) {
                    return i; // Return the index if the file name matches
                }
            }
            return -1; // Return -1 if the file is not found
        }

        function buttonBackAction() {
            let buttonBack = document.querySelector(".audioBack");
            selectAudio(audioFiles, findFileIndex(audioFiles, currentAudio) - 1);
            if (buttonAutoPlayState === 1) { audioPlayer.play() } else if (buttonPlayState === 'pause') {
                buttonPlay.textContent = "‚ñ∂";
                buttonPlayState = "play";
            };
        }

        function buttonPlayAction() {
            switch (buttonPlayState) {
                case 'play':
                    audioPlayer.play()
                    buttonPlay.textContent = "‚è∏";
                    buttonPlayState = "pause";
                    break
                case 'pause':
                    audioPlayer.pause()
                    buttonPlay.textContent = "‚ñ∂";
                    buttonPlayState = "play";
                    break
            }
            console.log("buttonPlayState: " + buttonPlayState);
        }

        function buttonNextAction() {
            let newFileIndex = (findFileIndex(audioFiles, currentAudio) + 1) % audioFiles.length
            selectAudio(audioFiles, newFileIndex)
            if (buttonAutoPlayState === 1) { audioPlayer.play() } else if (buttonPlayState === 'pause') {
                buttonPlay.textContent = "‚ñ∂";
                buttonPlayState = "play";
            };

        }

        function buttonLoopAction() {
            let buttonLoop = document.querySelector(".audioLoop")
            switch (buttonLoopState) {
                case 1:
                    buttonLoop.textContent = "üîÅ";
                    buttonLoopState = 2;
                    break;
                case 2: //case 2 + default
                    buttonLoop.textContent = "‚Ü™";
                    buttonLoopState = 0;
                    break;
                default: //case 0 + default
                    buttonLoop.textContent = "üîÇ";
                    buttonLoopState = 1;
                    break;
            }
            console.log("buttonLoopState: " + buttonLoopState);
        }

        function buttonAutoPlayAction() {
            let buttonAutoPlay = document.querySelector(".audioAutoPlay")
            switch (buttonAutoPlayState) {
                case 1:
                    buttonAutoPlay.textContent = "‚§µ";
                    buttonAutoPlayState = 0;
                    break;
                default: //case 0 + default
                    buttonAutoPlay.textContent = "üîÉ";
                    buttonAutoPlayState = 1;
                    break;
            }
            console.log("buttonAutoPlayState: " + buttonAutoPlayState)
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function FileListShuffleMatchArray(fileList, array) {
            let dataTransfer = new DataTransfer(); //creates storage for shuffled fileList

            // Reorder the files based on the indices
            array.forEach(index => {
                let file = fileList.item(index); // Get the file at the specific index
                dataTransfer.items.add(file); // Add the file to the reordered FileList
            });
            return dataTransfer.files;
        }

        function buttonShuffleAction() {
            let buttonShuffle = document.querySelector(".audioShuffle")
            switch (buttonShuffleState) {
                case 1:
                    audioFiles = originalAudioFiles;

                    buttonShuffle.textContent = "‚û°";
                    buttonShuffleState = 0;
                    break;
                default: //case 0 + default
                    originalAudioFiles = audioFiles;
                    shuffledNumbers = shuffleArray(ascendingNumbers);
                    audioFiles = FileListShuffleMatchArray(audioFiles, shuffledNumbers);

                    buttonShuffle.textContent = "üîÄ";
                    buttonShuffleState = 1;
                    break;
            }
            console.log("buttonShuffleState: " + buttonShuffleState);
            console.log("-------");
            for (i = 0; i < audioFiles.length; i++) {
                console.log("audioFiles[" + i + "]: " + audioFiles[i].name);
            }
            console.log("-------");
        }

        // document.getElementsByClassName("audioToPlay")[0].src = document.getElementsByClassName("audioInput")[0].value

    </script>
</body>

</html>
